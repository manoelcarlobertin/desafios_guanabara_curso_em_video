ğŸ”¥ ConversÃ£o do CÃ³digo para Ruby com Melhorias, ModularizaÃ§Ã£o e PadrÃµes de Projetos
ğŸ’ª Objetivo
Este cÃ³digo simula um Caixa EletrÃ´nico que realiza saques em dinheiro, calculando a quantidade de cÃ©dulas necessÃ¡rias para o valor informado pelo cliente.

ğŸ”‘ Requisitos Implementados
ModularizaÃ§Ã£o	âœ…
ValidaÃ§Ãµes Centralizadas	âœ…
PadrÃ£o DRY	âœ…
Armazenamento AutomÃ¡tico em JSON com SQLite3	âœ…
SaÃ­da Bonita UTF-8	âœ…
Uso de Gems TTY	âœ…
SeguranÃ§a com Rescues	âœ…
Resumo Educado ao Cliente	âœ…
Encapsulamento	âœ…
Escalabilidade

ğŸ“¦ Gems Utilizadas
tty-prompt
tty-spinner
colorize
sqlite3
json
active_support
active_support/core_ext

ğŸ“Œ Estrutura de Pastas

caixa_eletronico/
â”œâ”€â”€ main.rb           # Arquivo Principal
â”œâ”€â”€ database.rb       # ConexÃ£o SQLite3
â”œâ”€â”€ saque.rb          # LÃ³gica de NegÃ³cio
â””â”€â”€ utils.rb          # MÃ©todos Auxiliares


ğŸ”¥ Arquivo database.rb

require 'sqlite3'

class Database
  DB_NAME = 'saques.db'.freeze

  def self.connection
    db = SQLite3::Database.new(DB_NAME)
    db.execute <<-SQL
      CREATE TABLE IF NOT EXISTS saques (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        valor INTEGER,
        data_hora TEXT
      );
    SQL
    db
  end

  def self.save(valor)
    db = connection
    db.execute("INSERT INTO saques (valor, data_hora) VALUES (?, ?)", valor, Time.now.strftime('%d/%m/%Y %H:%M:%S'))
  end
end

------------------------------------------------------------------------------------------------------------
ğŸ”¥ Arquivo utils.rb

require 'colorize'
require 'tty-spinner'

module Utils
  def self.show_message(text, color = :cyan)
    puts text.colorize(color)
    sleep(0.3)
  end

  def self.format_currency(value)
    "R$#{'%.2f' % value}".gsub('.', ',')
  end

  def self.spinner(text)
    spinner = TTY::Spinner.new("ğŸŒŸ #{text} [:spinner]", format: :pulse_2)
    spinner.auto_spin
    sleep(1)
    spinner.success("âœ…")
  end
end

------------------------------------------------------------------------------------

ğŸ”¥ Arquivo saque.rb

require_relative 'utils'
require_relative 'database'
require 'tty-prompt'

class Saque
  CEDULAS = [100, 50, 20, 10, 5, 2, 1].freeze

  def initialize
    @prompt = TTY::Prompt.new
    @valor = 0
    @resultado = {}
  end

  def iniciar
    loop do
      solicitar_valor
      calcular_notas
      exibir_resumo
      Database.save(@valor)
      break unless continuar?

      Utils.spinner('Preparando novo saque...')
    end
  end

  private

  def solicitar_valor
    @valor = @prompt.ask('ğŸ’° Quanto deseja sacar?', convert: :int) do |q|
      q.validate(/\A\d+\z/, 'âš ï¸ Apenas valores inteiros positivos sÃ£o permitidos.')
      q.convert(:int)
      q.modify(:strip)
    end
  rescue TTY::Prompt::ConversionError
    Utils.show_message('âŒ Valor invÃ¡lido! Tente novamente.', :red)
    retry
  end

  def calcular_notas
    Utils.spinner('Calculando notas...')
    restante = @valor
    CEDULAS.each do |cedula|
      quantidade = restante / cedula
      restante %= cedula
      @resultado[cedula] = quantidade if quantidade.positive?
    end
  end

  def exibir_resumo
    Utils.show_message("\nğŸ¤‘ Resumo do Saque:", :green)
    puts '=' * 40
    @resultado.each do |nota, quantidade|
      puts "ğŸ’µ #{quantidade} nota(s) de #{Utils.format_currency(nota)}".colorize(:yellow)
    end
    puts '=' * 40
    puts "Valor Total: #{Utils.format_currency(@valor)}".colorize(:cyan)
    puts "Data e Hora: #{Time.now.strftime('%d/%m/%Y %H:%M:%S')}".colorize(:light_blue)
    Utils.show_message("\nğŸ¯ Obrigado por utilizar nosso caixa eletrÃ´nico! Volte sempre!", :green)
  end

  def continuar?
    @prompt.yes?('Deseja realizar outro saque?')
  end
end

-----------------------------------------------------------------------------------------------------

ğŸ”¥ Arquivo main.rb

require_relative 'saque'

Utils.show_message("\nğŸŒŸ Bem-vindo ao Caixa EletrÃ´nico Inteligente")
Saque.new.iniciar


--------------------------------------------------------------------------------------------------------

ğŸ“Œ Como Rodar
Instale as dependÃªncias:

gem install colorize tty-prompt sqlite3 active_support

---------------------------------------------------------------------------------------------------

ğŸŒŸ Bem-vindo ao Caixa EletrÃ´nico Inteligente
ğŸ’° Quanto deseja sacar? 457

ğŸŒŸ Calculando notas... âœ…

ğŸ¤‘ Resumo do Saque:
========================================
ğŸ’µ 4 nota(s) de R$100,00
ğŸ’µ 1 nota(s) de R$50,00
ğŸ’µ 1 nota(s) de R$5,00
ğŸ’µ 2 nota(s) de R$1,00
========================================
Valor Total: R$457,00
Data e Hora: 03/03/2025 20:00:00
ğŸ¯ Obrigado por utilizar nosso caixa eletrÃ´nico! Volte sempre!
